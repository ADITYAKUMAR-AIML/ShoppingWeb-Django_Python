{% extends "main.html" %}


{% load static %}



{% block content %}



  <style>
    * {margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif;}
    body {background: var(--bg); color: var(--text);}

    /* Container */
    .product-container {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 2rem;
      padding: 2rem 5%;
      background: var(--card-bg);
      margin: 2rem auto;
      border-radius: 10px;
      box-shadow: 0 2px 8px var(--shadow);
      max-width: 1200px;
    }

    /* Product Images */
    .other-images  img{
      width: 100%;
      height: 100px;
      object-fit: fit;
      border-radius: 10px;
    }
    .main-img {
      height: 400px;
      width: 450px;
      border-radius: 10px;
      margin-bottom: 1rem;
    }
    .main-img img{
      width: 100%;
      height: 100%;
      object-fit: fit;
      border-radius: 10px;
    }


    .thumbnail-row {
      display: flex;
      gap: 0.5rem;
    }
    .thumbnail-row img {
      width: 70px;
      height: 70px;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: 0.3s;
    }
    .thumbnail-row img:hover {
      border-color: #ff6b6b;
    }

    /* Product Details */
    .product-details h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    .rating {
      color: gold;
      margin-bottom: 1rem;
    }
    #price {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      color: #ff6b6b;
    }
    .old-price {
      text-decoration: line-through;
      color: var(--muted-text);
      font-size: 1rem;
      margin-left: 0.5rem;
    }
    .description {
      margin: 1rem 0;
      line-height: 1.5;
    }

    /* Quantity + Buttons */
    .actions {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 1rem 0;
    }
    .quantity {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .quantity button {
      background: #ff6b6b;
      border: none;
      color: #fff;
      padding: 0.5rem 0.8rem;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }
    .quantity span {
      min-width: 30px;
      text-align: center;
      font-weight: bold;
    }
    .add-cart {
      background: #ff6b6b;
      color: #fff;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
    }
    .add-cart:hover {opacity: 0.9;}

    /* Product Info */
    .product-info {
      margin-top: 2rem;
    }
    .product-info h2 {
      margin-bottom: 0.5rem;
    }
    .product-info ul {
      margin-left: 1.5rem;
      list-style: disc;
    }

    /* Related Products */
    .related {
      padding: 2rem 5%;
      margin-top: 2rem;
    }
    .related h2 {
      margin-bottom: 1.5rem;
      color: #ff6b6b;
    }
    .related-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px,1fr));
      gap: 1.5rem;
    }
    .related-item {
      background: var(--card-bg);
      padding: 1rem;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 6px var(--shadow);
      transition: 0.3s;
    }
    .related-item img {
      max-width: 100%;
      border-radius: 10px;
      margin-bottom: 0.8rem;
    }
    .related-item:hover {transform: translateY(-5px);}
    .related-item button {
      background: #ff6b6b;
      color: #fff;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 0.5rem;
    }

    /* Responsive */
    @media (max-width: 900px) {
      .product-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  <!-- Product Container -->
  <div class="product-container">

<div class="product-images">

  <!-- Main image -->
  {% if item.images.exists %}
    <img src="{{ item.images.first.image.url }}" alt="{{ item.name }}" class="main-img" id="mainImage">
  {% else %}
    <img src="{% static 'images/blank_image.png' %}" alt="{{ item.name }}" class="main-img" id="mainImage">
  {% endif %}

  <!-- Thumbnails -->
  <div class="thumbnail-row">
    {% for img in item.images.all %}
      <img src="{{ img.image.url }}" alt="{{ item.name }}" class="other-images" onclick="changeImage(this)">
    {% empty %}
      <img src="{% static 'images/blank_image.png' %}" alt="{{ item.name }}" class="other-images" onclick="changeImage(this)">
    {% endfor %}
  </div>
</div>




    <!-- Details -->
    <div class="product-details">
      {% if request.user.is_authenticated and item.user == request.user %}
      <a href="{% url 'edit_item' item.pk %}">Edit</a>
      {% endif %}


      <div style="display:flex; align-items:center; gap:10px;">
        <h1 style="margin:0;">{{ item.name }}</h1>
        <p style="margin:0; color:grey;">{{ item.category }}</p>
      </div>

      <div class="rating">⭐⭐⭐⭐☆ (120 reviews)</div>
      <div>
        <span id="price">${{ item.price }}</span>
      </div>
      <p class="description">
        {{item.description}}
      </p>
      
      <div class="actions">
        <div class="quantity">
          <button onclick="updateQty(-1)">-</button>
          <span id="qty">1</span>
          <button onclick="updateQty(1)">+</button>
        </div>
        <button class="add-cart">Add to Cart</button>
      </div>

      <div class="product-info">
        <h2>Product Details</h2>
        <ul>
           {% for spec in item.specifications.all %}
            <li>{{ spec.key }}: {{ spec.value }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <!-- Related Products -->
  <section class="related">
    <h2>Related Products</h2>
    <div class="related-grid">
      <div class="related-item">
        <img src="https://via.placeholder.com/200" alt="Related">
        <h3>Smart Watch</h3>
        <p>$50</p>
        <button>Add to Cart</button>
      </div>
      <div class="related-item">
        <img src="https://via.placeholder.com/200" alt="Related">
        <h3>Gaming Mouse</h3>
        <p>$40</p>
        <button>Add to Cart</button>
      </div>
      <div class="related-item">
        <img src="https://via.placeholder.com/200" alt="Related">
        <h3>Wireless Speaker</h3>
        <p>$60</p>
        <button>Add to Cart</button>
      </div>
    </div>
  </section>

  <!-- Script -->
<script>
  // Change main image when thumbnail clicked
  function changeImage(img) {
    document.getElementById("mainImage").src = img.src;
  }

  // Quantity & Price update
// Robust updateQty function
function updateQty(val, {
  qtyId = 'qty',
  priceId = 'price',
  subtotalId = 'subtotal', // optional: update another element if provided
  currency = 'USD'         // change to your currency if needed (e.g. 'INR', 'EUR')
} = {}) {
  const qtyEl = document.getElementById(qtyId);
  const priceEl = document.getElementById(priceId);
  const subtotalEl = subtotalId ? document.getElementById(subtotalId) : null;
  if (!qtyEl || !priceEl) return;

  // support <input> or <span>
  const isInput = qtyEl.tagName === 'INPUT' || qtyEl.tagName === 'TEXTAREA';
  let qty = parseInt(isInput ? qtyEl.value : qtyEl.textContent, 10);
  if (!Number.isFinite(qty) || qty < 1) qty = 1;

  // get unit price: prefer a stored data attribute
  let unitPrice = null;
  if (priceEl.dataset && priceEl.dataset.unitPrice) {
    unitPrice = parseFloat(priceEl.dataset.unitPrice);
  } else {
    // fallback: parse displayed number
    const displayed = parseFloat((priceEl.textContent || '').replace(/[^0-9.-]/g, '')) || 0;
    // if displayed likely is total (qty > 1) compute unit guess
    unitPrice = qty > 0 ? (displayed / qty) : displayed;
  }
  if (!Number.isFinite(unitPrice)) unitPrice = 0;

  // update qty but do not go below 1
  qty = Math.max(1, qty + val);

  // update qty element
  if (isInput) qtyEl.value = qty; else qtyEl.textContent = qty;

  // compute new total and update display
  const newTotal = unitPrice * qty;

  // keep unit price persisted for future clicks (so we don't lose it)
  priceEl.dataset.unitPrice = unitPrice.toFixed(2);

  // format price using Intl.NumberFormat for consistent currency display
  try {
    const fmt = new Intl.NumberFormat(undefined, { style: 'currency', currency });
    priceEl.textContent = fmt.format(newTotal);
    if (subtotalEl) subtotalEl.textContent = fmt.format(newTotal);
  } catch (e) {
    // fallback if Intl can't be used: basic formatting with $ and 2 decimals
    priceEl.textContent = '$' + newTotal.toFixed(2);
    if (subtotalEl) subtotalEl.textContent = '$' + newTotal.toFixed(2);
  }
}


</script>


{%endblock%}
